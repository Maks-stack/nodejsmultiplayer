<!DOCTYPE HTML>
<HTML>
   <HEAD>
       <Title>Phaser Game</Title>
       <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
       <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
   </HEAD>
   <BODY>
      <div class = "container-fluid text-center">
      <div id = "debug">DEBUG</div>

        <canvas id = "ctx" width = "500" height = "500" style = "border: 1px solid#000000"></canvas>
        <div id = "chat-text" style = "display:block;text-align:left; width: 500px;height:100px;overflow-y:scroll">
            <div>CHAT</div>
        </div>
        <div class = "chat">
            <form id = "chat-form">
              <input id = "chat-input" type = "text" style = "width:500px"></input>
            </form>
        </div>
      </div>

       <script type = "text/javascript">
        var chatText = document.getElementById('chat-text');
        var chatInput = document.getElementById('chat-input');
        var chatForm = document.getElementById('chat-form');
        var debug = document.getElementById('debug');

        var ctx = document.getElementById("ctx").getContext("2d");
         ctx.font = '5px Arial'; 

         var socket = io();

         socket.on('newPositions', function(data){
         		ctx.clearRect(0,0,500,500);
            for(var i = 0; i < data.length; i++)
            {
                ctx.fillStyle= data[i].color;
                ctx.fillRect(data[i].x ,data[i].y, 10,10);
                debug.innerHTML = i;
            }
         });

         socket.on('addToChat', function(data){
            chatText.innerHTML += '<div>' + data + '</div>';
         });

         chatForm.onsubmit = function(e){
            e.preventDefault();
            socket.emit('sendMsgToServer', chatInput.value);
            chatInput.value = '';
         }

         document.onkeydown = function(event){
            if(event.keyCode == 68)
              socket.emit('keyPress', {inputId: 'right', state:true});
            else if(event.keyCode == 83)
              socket.emit('keyPress', {inputId: 'down', state:true});
            else if(event.keyCode == 65)
              socket.emit('keyPress', {inputId: 'left', state:true});
            else if(event.keyCode == 87)
              socket.emit('keyPress', {inputId: 'up', state:true});
         }

         document.onkeyup = function(event){
            if(event.keyCode == 68)
              socket.emit('keyPress', {inputId: 'right', state:false});
            else if(event.keyCode == 83)
              socket.emit('keyPress', {inputId: 'down', state:false});
            else if(event.keyCode == 65)
              socket.emit('keyPress', {inputId: 'left', state:false});
            else if(event.keyCode == 87)
              socket.emit('keyPress', {inputId: 'up', state:false});
         }

       </script>
   </BODY>
</HTML>